## 파일시스템이란 ?

- 운영체제가 저장매체에 파일을 쓰기위한 자료구조 또는 알고리즘

> 파일시스템 등장배경
> - 비트단위로 저장매체를 관리하는 것은 오버헤드가 큼.
> - 블록단위(4KB)로 블록마다 번호를 부여해 관리한다고 해도 사용자가 블록번호를 관리하기는 어려움
> - 사용자가 이해하기쉬운 파일단위로 관리할 수 있도록 파일시스템을 개발

> 저장매체에 효율적으로 파일을 저장하는 방법
> - 가능한 연속된 공간에 파일을 저장하는 것이 효율적
> - 외부단편화 및 파일사이즈 변화이슈로 인해 불연속공간에 파일 저장하는 기능이 필요하게 됨
>   - 블록체인 방식 : 파일을 블록단위로 쪼개어 블록을 링크드 리스트로 연결하고 첫블록 주소만 관리하는 것
>   - 인덱스 블록 기법 : 파일을 구성하는 실제 데이터를 블록단위로 쪼개고 각 블록에 대한 대한 위치정보를 파일 상세정보에 저장하여 관리

## 파일 시스템 종류

- Windows : FAT,FAT32,NTFS
- 리눅스 : ext2,ext3,ext4 (인덱스 블록 기법을 기반으로 만든 inode 방식 사용)

## 파일 시스템과 시스템 콜

- 동일 시스템 콜을 사용하여 다양한 파일시스템을 지원하도록 구현되어있다.
    - read/write 시스템 콜 호출시 내부적으로 파일시스템에 따라 호출되는 함수가 각기 구현되어있다. (ex: read_spec/write_spec)
    - 파일을 실제 어떻게 저장할지는 다를수 있다.(파일시스템이 다르므로)
        - 리눅스는 ext4외에 NTFS와 FAT32파일시스템도 지원한다.

## inode 방식의 파일 시스템

![image](https://user-images.githubusercontent.com/49670068/119796927-c0cf6300-bf14-11eb-8f30-6fa8f4977ec3.png)

- 기본 구조
    - 수퍼블록 : 파일시스템 정보
    - 아이노드 블록 : 파일 상세정보
    - 데이터 블록 : 실제 데이터

- 수퍼블록 : os에서 관리하는 파일시스템들과 파티션 정보를 포함하고 있다.

![image](https://user-images.githubusercontent.com/49670068/119793329-739dc200-bf11-11eb-96a5-5b5aea7165f0.png)

> df라는 명령은 수퍼블록을 기반으로 어떤 파일시스템 들이 있고, 블록의 개수는 몇개이며, 사용되는 용량과 여유 용량, 사용퍼센트, 파일시스템이 붙여진 디렉토리등 과 같은 정보를 출력한다.

- 각 파일은 inode 고유값을 가지며, 자료구조에 주요 정보가 관리된다.
- `파일이름:inode번호`로 파일이름은 inode번호와 매칭되어 있다.
- 파일시스템은 inode를 기반으로 파일을 엑세스한다.
- 각 파일은 inode 기반의 메타데이터(파일권한,소유자정보,파일사이즈,생성시간등)를 갖는다.

![image](https://user-images.githubusercontent.com/49670068/119793888-f45cbe00-bf11-11eb-9a66-aea56737a2f0.png)

> cat files.txt라는 명령으로 해당 파일의 실제데이터를 볼 수 있으며, ls -al files.txt라는 명령은 inode기반 메타데이터 정보를 기반으로 권한정보,소유자정보,생성시간,크기등을 출력한다.

## inode구조와 파일데이터

![image](https://user-images.githubusercontent.com/49670068/119794208-4a316600-bf12-11eb-9945-fba8705e63ad.png)

- Direct blocks는 12개의 블록의 주소를 가지고 있다.(4KB * 12만큼의 저장공간 관리)
- Single Indirect는 4KB를 주소를 저장하는 단위인 4바이트로 쪼개 1024개의 공간을 통해 4KB의 블록에 대한 주소를 가지고 있는 테이블을 가르키고 있다.(약 4MB 저장공간 관리)
- Double Indirect는 Single Indirect가 가르키는 테이블에 대한 주소를 1024개 가지고 있는 테이블을 가르킨다.(약 4GB의 저장공간 관리)
- Triple Indirect는 Double Indirect가 관리하는 테이블에 대한 주소를 1024개 가지고 있는 테이블을 가르킨다.(약 4TB의 저장공간 관리)

## 디렉토리 엔트리

- 디렉토리 엔트리는 디렉토리마다 가지고 있는 파일/디렉토리에 대한 정보이다.
- 예를 들어 /home/ubuntu/link.txt의 경우 `/` 디렉토리 엔트리에서 `home`을 찾고 `home` 디렉토리 엔트리에서 `ubuntu` 디렉토리를 찾고 `ubuntu`디렉토리 엔트리에서 link.txt 파일에 대한 inode번호를 얻는다.

## 가상 파일 시스템 (VFS)

- 원격지에 있는 파일시스템, 즉 네트워크로 연결된 원격 파일시스템도 가상 파일 시스템 인터페이스를 통해 마치 현재 로컬에 존재하는 파일시스템과 동일하게 관리할 수 있다.
- VFS가 있기때문에 read/write와 같은 하나의 시스템 콜을 다양한 파일시스템에 접근이 가능

![image](https://user-images.githubusercontent.com/49670068/119796178-1a835d80-bf14-11eb-9ede-5ed5888650a1.png)

> 리눅스 OS는 모든 것을 파일로 취급하기때문에 디바이스(마우스,키보드) 장치도 파일로 취급된다.
> 즉, 모든 자원에 대한 추상화 인터페이스로 파일 인터페이스를 활용한다.
> - 디바이스는 특수파일로 취급된다. 
> - HDD,CD/DVD와 같이 큰 용량을 저장하는 디바이스는 블록 또는 섹터등 정해진 단위로 데이터를 전송한다. 
> - 키보드,마우스 디바이스는 바이트단위로 데이터가 전송됨
