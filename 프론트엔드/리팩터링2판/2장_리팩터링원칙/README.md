### 리팩터링의 정의

- 리팩터링은 명사적 동사적으로 정의가 가능하다.
`명사적 정의` : 소프트웨어 겉보기 동작은 그대로 유지한 채 `코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법`
`동사적 정의` : 소프트웨어 겉보기 동작은 그대로 유지한 채 `여러가지 리팩터링 기법을 적용하여 소프트웨어를 재구성하다.`

- `리팩터링 하는 동안에는 항상 코드가 정상 작동해야 한다.` 그렇기에 작업이 끝나지 않았어도 언제든 멈출 수 있다.

- 리팩터링을 여러 단계를 통해 작업하다보면 비효율적이라고 생각할 수 있으나, 잘게 나눔으로써, 오히려 작업을 빨리처리할 수 있다.

- 리팩터링 과정에서 성능이 변할 수 있으나, `리팩터링의 목적은 코드를 이해하고 수정하기 쉽게 만드는 것이기에 목적에 집중하도록 하자.`

### 두개의 모자

- 소프트웨어를 개발할 때는 목적이 `기능 추가`냐, `리팩터링`이냐를 명확히 구분해 작업해야한다.
- `기능 추가`시에는 기존코드는 절대 건드리지 않고, `새 기능 추가에만 집중`한다.
- `리팩터링`시에는 `기능 추가는 절대하지 않기로 다짐`하고 리팩터링을 수행해야한다.
- `기능 추가`와 `리팩터링` 두개의 모자를 자주 바꿔 쓸 수 있으나, `현재 내가 지금 하고 있는 작업 목적을 명확히 구분`하고 작업 방식의 차이를 분명하게 인식해야한다.

### 리팩터링을 왜 할까 ?

1. 소프트웨어 설계가 좋아진다.(품질)

`리팩터링을 하지 않으면 코드만으로 설계를 파악하기 어려워지고`, 이에 따라 설계를 유지하기 어려워진다.
같은 일을 하더라도 `설계가 나쁘면 코드가 길어지며, 작업량이 늘어난다`.
`중복 코드 제거는 설계 개선 작업의 가장 중요한 요소`이다. 중복 코드 제거를 통해 `코드를 수정하는데 드는 노력은 크게 줄어들며`, 코드에 중복코드가 많다면 한 부분만 바꾼다고 시스템이 예상대로 동작하지 않을 수 있기에 중복 코드 제거는 바람직한 설계의 핵심이다.

2. 버그를 쉽게 찾을 수 있다.(디버깅)

코드를 이해하기 쉽다는 말은 버그를 찾기 쉽다는 말이기도 하다. `리팩터링을 진행하면서 코드가 하는 일을 깊이 파악하게 되면서 새로 깨달은 것을 곧바로 코드에 반영`하게된다. 또한 `구조를 명확하게 다듬으면 가정하던 점들이 명확하게 드러나며`, 버그를 쉽게 발견할 수 있다.

> 켄트 백 : 나는 뛰어난 프로그래머가 아닙니다. 단지 뛰어난 습관을 가진 괜찮은 프로그래머일 뿐이에요.

3. 프로그래밍 속도를 높일 수 있다.(생산성)

사람들은 리팩터링으로 인해 프로그래밍 시간이 길어질까라고 걱정 할 수 있다.
하지만 `실제 한 시스템을 오래 개발 중인 개발자들과 얘기해보면 초기에는 진척이 빨랐으나, 현재는 새 기능 하나를 추가하는데 훨씬 오래 걸린다는 말을 많이 한다`. 즉, 새로운 기능을 추가할 수록 기존 코드베이스에 녹여내는데 드는 시간이 늘어난다는 것이다.
`또한 기능 추가 후 버그가 자주 발생하며, 해결하는 시간은 더욱 오래걸린다`.
심지어 처음 개발하는게 낫다고 생각하게 될 수 있다.
그러나 `내부 설계가 잘 된 소프트웨어는 새 기능을 추가할 지점과 어떻게 고칠지 쉽게 찾을 수 있다`.
`모듈화가 잘되어있다면 코드 베이스의 일부만 이해`해도 된다.
결국은 `빠른 개발을 위해 리팩터링은 반드시 필요`하다.

> 20년 전에는 설계를 먼저 완벽하게 하고 시작하는게 정설이었으나, 리팩터링을 통해 기존 코드 설계를 얼마든지 개선할 수 있다.

> 지구력 가설 : 내부 설계에 심혈을 기울이면 소프트웨어의 지구력이 높아져 빠르게 개발할 수 있는 상태를 오래 지속할 수 있다는 가설

### 언제 리팩터링을 해야 할까 ?

1. 3의 법칙

비슷한 일을 세 번째 하게 되면 리팩터링한다.(비슷한 코드를 3번이상 작성하게되면 리팩터링 고려)

2. 준비를 위한 리팩터링

리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전이다. 이시점에 코드를 살펴보면서 구조를 살짝 바꾸면 다른 작업을 하기가 훨씬 쉬워질 만한 부분을 찾는다.
상황을 미리 개선해 놓으면 기능추가하기가 수월하고, 버그를 수정한 상태가 오래 지속되며, 같은 곳에서 다른 버그가 발생할 가능성을 줄일 수 있다.

3. 이해를 위한 리팩터링

코드를 분석할 때 마다 그 코드의 의도가 명확하게 드러나도록 리팩터링 여지를 찾는다.
이해한 부분을 코드에 반영해둔다면 오래 보존 할 수 있으며, 동료들도 알 수 있다.
또한 리팩터링을 하면서 코드의 깊은 수준까지 이해할 수 있으며, 그에따라 숨어있는 버그를 발견할 가능성도 커진다.

4. 쓰레기 줍기 리팩터링

로직이 쓸데없이 복잡하거나, 중복되는 로직을 여러 함수가 사용하는 것을 발견했을때, 그대로 두지 않고, 고칠 수 있다면 즉시 고치는 것이 좋다.

5. 계획된 리팩터링을 자제하자.

리팩터링을 계획으로 인해 리팩터링을 해야하는 상황에서 특정 문제가 발생할 경우에는 팀원 여럿이 달려들어야 할 정도로 곪아 갈 수도 있다. 
기회가 될때마다 하는 것이 좋다.
또한 git에서 리팩터링과 기능 추가 커밋을 분리하지 않는 것이 좋다.
굳이 나누면 시간낭비 일 뿐더러, 리팩터링은 기능추가와 밀접하게 연관되어 있는 경우가 많기 떄문이다.
맥락정보를 유지하기 위해서는 기능추가와 리팩터링 커밋을 분리하지 않는 게 좋다.

6. 오래 걸리는 리팩터링

리팩터링은 오랜기간에 걸쳐 조금씩 해결해 가는 편이 효과적이다. 누군가 리팩터링할 코드와 관련된 작업을 하게 될때마다 원하는 방향으로 조금씩 개선하는 식이 좋다.
라이브러리를 교체하는 경우 기존 것과 새것을 모두 포용하는 추상 인터페이스부터 마련하는 것이 좋다. 기존 코드가 추상 인터페이스를 호출하도록 하면 라이브러리를 쉽게 교체할 수 있다.

7. 코드 리뷰에 리팩터링 활용

코드 리뷰는 개발팀 전체에 지식을 전파하기 좋으며, 다른사람의 아이디어를 얻을 수 있다.
리팩터링은 코드 리뷰의 결과를 더 구체적으로 도출 하는데 도움이 된다. 개선안을 제시하는데 그치지 않고, 상당 수를 직접 구현해 볼수 있기 떄문이다.
하지만 풀 요청 모델에서는 효과적이지 않으며, 이왕이면 코드 작성자가 참석하여 작성자와 함께 나란히 앉아 코드를 훑어가며 리팩터링을 하는 것이 매우 좋다.(페어 프로그래밍과 리팩터링)

8. 리팩터링은 빠른 작업을 위한 사전 작업이다.

프로라면 관리자에게 굳이 리팩터링을 한다고 말할 필요가 없다. 리팩터링으로 인해 시간이 걸린다고 말하려 했는가 ? 어짜피 빠르게 개발하기 위해서 리팩터링을 하는 것이다. 리팩터링은 결국 관리자를 위한 것이아닌 개발자 자신을 위한 것임을 명심하라.

9. 리팩터링을 하지 말아야 할때

굳이 수정할 필요가 없는 코드라면 리팩터링을 자제하는 것이 좋다.
리팩터링하는 것보다 처음부터 작성하는게 쉬울때도 리팩터링 하지 않는다.

### 리팩터링시 고려할 문제

1. 새 기능 추가시 준비를 위한 리팩터링은 변경을 수월하게 한다.

건강한 코드의 위력을 충분히 경험ㅎ보지 않고서는 코드베이스가 건강할 떄와 허약할 떄의 생산성 차이를 체감하기 어렵다.
리팩터링을 단순히 클린코드나 바람직한 엔지니어링 습관처럼 도덕적인 이유로 정당화 하면 안된다.
리팩터링의 본질은 개발기간을 단축하는 것이다.

2. 코드 소유권은 느슨한 것이 좋다.

함수 선언 바꾸기를 통해 함수이름을 변경해야할때, 함수를 호출하는 코드가 내게 쓰기권한이 없을 수 있다.
이를 방지하기 위해 다른팀이 자기 팀 코드의 브랜치를 따서 수정하고 커밋을 요청하는 오픈소스 개발 모델을 권장한다.

3. 브랜치 통합은 자주하는 것이 좋다.

CI(지속적 통합)이란 브랜치의 통합 주기를 2~3일 단위로 짧게 관리하는 것을 말한다. CI에 따르면 모든 팀원이 하루에 최소 한번은 마스터와 통합하는 것을 권장한다. 이러한 CI는 머지의 복잡도를 낮출수 있다.
CI를 완벽히 적용하지는 못하더라도 통합 주기는 최대한 짧게 잡는 것이좋다.

4. 자가 테스트를 마련하는 것은 필수이다.

리팩터링을 하면 동작이 깨지지 않아야하며 실수하더라도 재빨리 해결해야한다. 이를 위해서는 다양한 측면을 검사하는 테스트 스위트가 필요하다.
테스트 코드는 새 기능 추가시 안정성을 높혀주며, 리팩터링시 버그를 발생 여지를 줄여준다.
또한 테스트 코드는 통합과정에서 의미있는 충동을 잡는 메커니즘으로 활용가능해 CI와도 밀접하게 연관된다.

5. 레거시 코드

레거시 코드 분석시 리팩터링이 도움이 될수 있다.
또한 테스트를 갖추는 것이 좋다.
자주 보는 영역을 자주 리팩터링 하도록 한다.